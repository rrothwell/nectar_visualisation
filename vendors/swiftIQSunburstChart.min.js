requirejs.config({
    paths: {
        jquery: "./lib/jquery-2.0.3.min",
        d3: "./lib/d3.v3",
        crossfilter: "lib/crossfilter.min",
        utility: "common/utility.min",
        bootstrap: "./lib/bootstrap.min",
        "bootstrap-datepicker": "./lib/bootstrap-datepicker"
    },
    shim: {
        jquery: {
            exports: "jquery"
        },
        d3: {
            exports: "d3"
        },
        crossfilter: {
            deps: ["d3"],
            exports: "crossfilter"
        },
        bootstrap: {
            deps: ["jquery"],
            exports: "bootstrap"
        },
        "bootstrap-datepicker": {
            deps: ["bootstrap"],
            exports: "$.datepicker"
        }
    }
});
define("jquery d3 utility crossfilter bootstrap bootstrap-datepicker".split(" "), function(q, h, x) {
    function y(a, b) {
        return a === b?!0 : a.children ? a.children.some(function(a) {
            return y(a, b)
        }) : !1
    }
    function F(a) {
        return a.color || "transparent"
    }
    function T(a) {
        function b(a, c, d) {
            a.color = d;
            if (a.children) {
                var s = 0, f = h.scale.linear().domain([0, a.size]).range([c, d]), s = 0;
                a.children.forEach(function(d, c) {
                    d.color = f(s).toString();
                    b(a.children[c], f(s), f(s + d.size));
                    s += d.size
                })
            }
        }
        var c = "#ffdb11 #217821 #aadc74 #5c9b19 #19258f #17becf #694026 #9467bd #e377c2 #e80c58 #e80c58 #b6272b #b00616 #ff7f0e #96ffcc #1ba763".split(" ").map(function(a) {
            a =
            h.hsl(a);
            return h.hsl(a.h, a.s / 1.1, 1.1 * a.l)
        }), d, e = c.length, f = a.length;
        for (d = 0; d < f; d++)
            b(a[d], c[2 * d%e], c[(2 * d + 1)%e])
    }
    function J(a, b) {
        return Math.max(0, Math.min(K, a(b.x)))
    }
    function L(a, b) {
        return Math.max(0, Math.min(K, a(b.x + b.dx)))
    }
    function M(a, b) {
        var c = J(a, b), d = L(a, b);
        return c < u && d < u && d - c < u ? 0 : d - c > n ? 1 : 0
    }
    function N(a, b) {
        var c = J(a, b), d = L(a, b);
        return c + n < G && d - n > G ? 0 : c + n < H && d - n > H ? 180 : 180 * a(b.x + b.dx / 2) / Math.PI-90
    }
    function O(a, b) {
        var c = N(a, b);
        return -90 <= c && 90 >= c ? "start" : "end"
    }
    function U(a, b, c, d, e) {
        var f = A(a),
        r = h.interpolate(c.domain(), [a.x, a.x + a.dx]), k = h.interpolate(d.domain(), [a.y, f]), t = h.interpolate(d.range(), [a.y ? V: 0, e]);
        return function(a) {
            return function(f) {
                c.domain(r(f));
                d.domain(k(f)).range(t(f));
                return b(a)
            }
        }
    }
    function A(a) {
        return a.children ? Math.max.apply(Math, a.children.map(A)) : a.y + a.dy
    }
    function B(a, b, c, d, e, f) {
        b = b.slice(0);
        c = c.slice(0);
        var r = b.pop(), k = c.pop(), t = crossfilter(a);
        a = a.reduce(function(a, b) {
            return a + b[d]
        }, 0);
        e = e || a;
        f = W(t, r, k, d, a, e, f || "total");
        0 < b.length ? f.forEach(function(a) {
            a.children =
            B(a.children, b.slice(0), c.slice(0), d, e, r + " " + a.id).sort(function(a, b) {
                return b.size - a.size
            })
        }) : f.forEach(function(a) {
            a.children = void 0
        });
        return f
    }
    function W(a, b, c, d, e, f, r) {
        return a.dimension(function(a) {
            return a[b]
        }).group().reduce(function(a, b) {
            a.data.push(b);
            a.size += b[d];
            return a
        }, function(a, b) {
            a.size -= b[d];
            return a
        }, function() {
            return {
                size: 0,
                data: []
            }
        }).all().map(function(a) {
            return {
                id: a.key,
                name: c + a.key,
                percent: x.formatPercent(a.value.size, e),
                parentName: r,
                text: "[" + x.abbreviateNumber(a.value.size) +
                ", " + x.formatPercent(a.value.size, f) + " of total]",
                size: a.value.size,
                children: a.value.data
            }
        })
    }
    function X(a) {
        for (var b = []; a.parent;)
            b.unshift(a), a = a.parent;
        0 < b.length && b.unshift(a);
        return b
    }
    function Y(a, b) {
        var c = a.append("svg:svg").attr("width", b).attr("height", g.h + g.margin).attr("id", a.attr("id") + "-trail");
        c.append("svg:text").attr("id", "endlabel").style("fill", "#000");
        return c
    }
    function Z(a, b) {
        var c = [];
        c.push("0,0");
        c.push(g.w + ",0");
        c.push(g.w + g.t + "," + g.h / 2);
        c.push(g.w + "," + g.h);
        c.push("0," + g.h);
        0 <
        b && c.push(g.t + "," + g.h / 2);
        return c.join(" ")
    }
    function $(a, b, c, d, e) {
        var f = a.selectAll("g").data(b, function(a) {
            return a.name + a.depth
        }), r = f.enter().append("svg:g");
        r.append("svg:polygon").attr("points", Z).on("click", e).attr("class", "breadcrumb-tag").attr("stroke-width", 0).attr("stroke", "black").style("fill", function(a) {
            return F(a)
        }).style("fill-opacity", 0).transition().duration(C).attr("stroke-width", 1).style("fill-opacity", 1);
        r.append("svg:text").attr("x", (g.w + g.t) / 2).attr("y", g.h / 2).attr("dy", "0.35em").attr("text-anchor",
        "middle").style("fill-opacity", 0).text(function(a) {
            return a.name || d
        }).on("click", e).transition().duration(C).style("fill-opacity", 1);
        f.attr("transform", function(a, b) {
            return "translate(" + b * (g.w + g.s) + ", 0)"
        });
        f.exit().remove();
        a.select("#endlabel").attr("dy", "0.35em").attr("text-anchor", "start").text(c).style("fill-opacity", 0).transition().duration(C).attr("x", b.length * (g.w + g.s) + g.t).attr("y", g.h / 2).style("fill-opacity", 1);
        h.select("#trail").style("visibility", "")
    }
    function aa(a) {
        var b = a.append("svg:svg").attr("width",
        200);
        a = {
            updateDrawing: function(a, d) {
                b.selectAll("g").remove();
                if (a) {
                    var e = b.selectAll("g").data(a).enter().append("svg:g").attr("transform", function(a, b) {
                        return "translate(0," + 33 * b + ")"
                    });
                    e.append("svg:rect").attr("rx", 3).attr("ry", 3).attr("width", 200).attr("height", 30).style("fill", function(a) {
                        return F(a)
                    }).on("click", d);
                    e.append("svg:text").attr("x", 100).attr("y", 15).attr("dy", "0.35em").attr("text-anchor", "middle").text(function(a) {
                        return a.name + " (" + a.percent + ")"
                    }).on("click", d)
                }
            }
        };
        Object.seal(a);
        return a
    }
    function P(a, b, c, d, e) {
        q.get(ba).then(function(f) {
            a.html(f.replace(/{{ConfirmButtonText}}/g, "Filter"));
            a.select("#title").text(b);
            var e = a.attr("id"), k, g;
            k = q("#" + e + " #dpd1").datepicker().on("changeDate", function(a) {
                a.date.valueOf() > g.date.valueOf() && g.setValue(a.date);
                k.hide();
                q("#" + e + " #dpd2")[0].focus()
            }).on("focus", function(a) {
                g.hide()
            }).data("datepicker");
            k.setValue(c);
            g = q("#" + e + " #dpd2").datepicker({
                onRender: function(a) {
                    return a.valueOf() < k.date.valueOf() ? "disabled" : ""
                }
            }).on("focus", function(a) {
                k.hide()
            }).on("changeDate",
            function(a) {
                a.date.valueOf() < k.date.valueOf() && k.setValue(a.date);
                g.hide()
            }).attr("value", d).data("datepicker");
            g.setValue(d);
            q("#" + e + " .btn-primary").off("click");
            q("#" + e + " .btn-primary").click(function(a) {
                q("#" + e).modal("hide");
                alert("Date range filtering disabled for this demo")
            })
        })
    }
    function ca(a, b, c, d, e, f, g, k) {
        function t(a) {
            var b = a.arcElement, d = a.textElement;
            try {
                b.attr("transform", "scale(1.01)"), d.style("font-weight", "bold"), I.name.text(a.name), I.value.text(a.size)
            } catch (c) {}
        }
        function s(a) {
            var b =
            a.arcElement;
            a = a.textElement;
            try {
                b.attr("transform", null), a.style("font-weight", "normal"), I.name.text(""), I.value.text("")
            } catch (d) {}
        }
        function z(a) {
            A.updateDrawing(a.children, z);
            var b = X(a);
            $(H, b, a.text, g, z);
            E.transition().duration(C).attrTween("d", U(a, B, p, D, n));
            Q.style("visibility", function(b) {
                return y(a, b) ? null : h.select(this).style("visibility")
            }).transition().duration(C).attrTween("text-anchor", function(a) {
                return function() {
                    return O(p, a)
                }
            }).attrTween("transform", function(a) {
                return function() {
                    var b =
                    N(p, a);
                    a.originalTextTransform = "rotate(" + b + ")translate(" + (D(a.y) + v) + ")rotate(" + (90 < b?-180 : 0) + ")";
                    return a.originalTextTransform
                }
            }).styleTween("fill-opacity", function(b) {
                return function() {
                    return y(a, b) ? M(p, b) : 1E-6
                }
            }).each("end", function(b) {
                h.select(this).style("visibility", y(a, b) ? null : "hidden").style("fill-opacity", function(b) {
                    return y(a, b) ? M(p, b) : 0
                })
            })
        }
        b = Number(b);
        var m = b = isNaN(b) || 0 >= b ? Math.min(window.innerWidth, window.innerHeight) - R: Math.min(b, Math.min(window.innerWidth, window.innerHeight) - R), n =
        m / 2, p = h.scale.linear().range([0, K]), D = h.scale.pow().exponent(1.3).domain([0, 1]).range([0, n]), v = 5, l, u;
        "string" === typeof k && (l = h.select("#" + k));
        l || (l = h.select("body"));
        l.text("");
        var G = q.Deferred(), w = l.append("div").attr("class", "title").attr("id", k + "_" + da);
        q.get(ea).then(function(a) {
            w.html(a);
            w.select("#title").text(c);
            w.select("#earliestDate").text(S(d)).on("click", x.once(function() {
                P(w, c, d, e, f)
            }));
            w.select("#latestDate").text(S(e)).on("click", x.once(function() {
                P(w, c, d, e, f)
            }));
            G.resolve()
        });
        k = l.append("div").attr("class",
        "bc-container").attr("id", "bcc");
        l = l.append("div");
        u = l.append("div").attr("id", l.attr("id") + "-legend").attr("class", "legend");
        var H = Y(k, m), A = aa(u), m = l.append("svg:svg").attr("width", m + 2 * v).attr("height", b + 2 * v).append("svg:g").attr("transform", "translate(" + [n + v, n + v] + ")");
        l = h.layout.partition().sort(null).value(function(a) {
            return a.size || 1
        });
        var B = h.svg.arc().startAngle(function(a) {
            return J(p, a)
        }).endAngle(function(a) {
            return L(p, a)
        }).innerRadius(function(a) {
            return Math.max(0, a.y ? D(a.y) : a.y)
        }).outerRadius(function(a) {
            return Math.max(0,
            D(a.y + a.dy))
        });
        l = l.nodes({
            children: a
        });
        var E = m.selectAll("path").data(l);
        E.enter().append("path").attr("id", function(a, b) {
            a.arcElement = h.select(this);
            return "path-" + b
        }).attr("d", B).attr("fill-rule", "evenodd").style("fill", F).on("click", z).on("mouseover", t).on("mouseout", s);
        var Q = m.selectAll("text").data(l);
        Q.enter().append("text").style("fill-opacity", function(a) {
            a.textElement = h.select(this);
            return M(p, a)
        }).style("fill", function(a) {
            a = h.rgb(F(a));
            return 125 > 0.299 * a.r + 0.587 * a.g + 0.114 * a.b ? "#eee" : "#000"
        }).attr("text-anchor",
        function(a) {
            return O(p, a)
        }).attr("dy", ".2em").attr("transform", function(a) {
            var b = N(p, a);
            a.originalTextTransform = "rotate(" + b + ")translate(" + (D(a.y) + v) + ")rotate(" + (90 < b?-180 : 0) + ")";
            return a.originalTextTransform
        }).on("click", z).on("mouseover", t).on("mouseout", s).append("tspan").attr("x", 0).text(function(a) {
            return a.depth ? a.name : ""
        });
        A.updateDrawing(a, z);
        var I = {
            name: m.append("svg:text").attr("class", "name-text").attr("text-anchor", "middle").attr("fill", "#333").attr("x", m.select("#path-0").attr("x")).attr("y",
            m.select("#path-0").attr("y")),
            value: m.append("svg:text").attr("class", "value-text").attr("text-anchor", "middle").attr("fill", "#666").attr("x", m.select("#path-0").attr("x")).attr("y", m.select("#path-0").attr("y") + 25)
        };
        return m
    }
    var ba = "../swiftiq-lib/templates/sunburst_datepicker_template.html", ea = "../swiftiq-lib/templates/sunburst_title_template.html", da = "datepicker_bar", C = 1E3, R = 80, V = 80, n = 0.05, u = 1E-10, K = 2 * Math.PI, G = Math.PI / 2, H = 3 * Math.PI / 2, g = {
        w: 125,
        h: 30,
        s: 3,
        t: 10,
        margin: 0
    }, fa = ["itemId", "department",
    "storeId"], ga = ["SKU: ", "Dept.: ", "Store: "], S = h.time.format("%b %d %Y"), E = {
        parseJson: function(a) {
            var b = new Date(2 * Date.now()), c = new Date(0);
            a.forEach(function(a) {
                a.dd = new Date(Number(a.dateProcessed) / 1E3);
                b > a.dd ? b = a.dd : c < a.dd && (c = a.dd);
                var e = Number(a.transactionGrandAmount) / 1E3;
                a.transactionTotal = isNaN(e) ? 0 : e;
                a.storeId = Number(a.storeId);
                a.department = Number(a.department)
            });
            return {
                data: a,
                earliestDate: b,
                latestDate: c
            }
        },
        createChart: function(a, b, c, d, e, f) {
            var g = this, k = B(a.filter(function(a) {
                return a.dd >=
                c && a.dd <= d
            }), b.levels || fa, b.labels || ga, b.sizeField || "transactionTotal"), h = function(c, d) {
                return g.createChart(a, b, c, d, e, f)
            };
            if (0 === k.length)
                alert("No data in the time interval selected");
            else 
                return T(k), f && "function" === typeof f.stop && f.stop(), ca(k, b.sideSize, b.title || "", c, d, h, b.defaultMessage || "", e)
        }
    };
    Object.seal(E);
    return E
});
